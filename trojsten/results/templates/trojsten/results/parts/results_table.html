{% load utils %}
{% load mathfilters %}

<table class="table table-hover table-responsive">
<thead>
<tr>
    <th class="text-right">#</th>
    <th>Meno:</th>
    <th><abbr title="Ročník" data-toggle="tooltip" data-placement="top">R.</abbr></th>
    <th>Škola</th>
    {% if has_previous_results %}
        <th><abbr title="Predchádzajúce kolá" data-toggle="tooltip" data-placement="top">P.</abbr></th>
    {% endif %}
    {% for task in tasks %}
        <th><a href="{% url 'task_statement' task_id=task.id %}" title="{{task.name}}" data-toggle="tooltip" data-placement="top">{{task.number}}</a></th>
    {% endfor %}
    <th><strong>&sum;</strong></th>
</tr>
</thead>
{% for result in results %}
{% spaceless %}
<tr {% if user == result.user %}class="active"{%endif%}>
    <td class="text-right">
    {% ifchanged result.data.sum %}<strong>{{result.data.rank}}. </strong>{% endifchanged %}
    {% if has_previous_results %}
        {% if result.data.prev_rank == None %}
            <span class="text-info glyphicon glyphicon-asterisk"></span>
        {% elif result.data.rank < result.data.prev_rank %}
            <span class="text-success glyphicon glyphicon-chevron-up" title="+{{result.data.prev_rank|sub:result.data.rank}}" data-toggle="tooltip" data-placement="top"></span>
        {% elif result.data.rank > result.data.prev_rank %}
            <span class="text-danger glyphicon glyphicon-chevron-down" title="-{{result.data.rank|sub:result.data.prev_rank}}" data-toggle="tooltip" data-placement="top"></span>
        {% else %}
            <span class="text-muted glyphicon glyphicon-pushpin"></span>
        {% endif %}
    {% endif %}
    </td>
    <td>{{result.user.first_name}} {{result.user.last_name}}</td>
    <td>{{result.user.school_year}}</td>
    <td>{%if result.user.school.has_abbreviation %}<abbr title="{{result.user.school.verbose_name}}" data-toggle="tooltip" data-placement="top">{{result.user.school.abbreviation}}</abbr>{%else%}{{result.user.school.verbose_name}}{%endif%}</td>
    {% if has_previous_results %}
        <td>{{result.data.previous}}</td>
    {% endif %}
    {% for task in tasks %}
        <td>
        {% lookup_as result.data.tasks task.id as task_points %}
        {% if task_points.submitted %}
            <span data-toggle="tooltip" data-placement="top" title="{% if task.description_points > 0 %}popis: {{task_points.description_points}}{% if task.source_points > 0 %} {% endif %}{% endif %}{% if task.source_points > 0 %}program: {{task_points.source_points}}{% endif %}">
                {% if task_points.description_pending %} ({{task_points.sum}}) {% else %} {{task_points.sum}} {% endif %}
            </span>
        {% endif %}
        </td>
    {% endfor %}

    <td><strong>{{result.data.sum}}</strong></td>
</tr>
{% endspaceless %}
{% empty %}
<tr><td colspan="{{tasks | length | add:5}}">Žiadne submity</td></tr>
{% endfor %}
</table>
